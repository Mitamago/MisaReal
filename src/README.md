# いまなにしてる？アプリ - 開発・デプロイガイド

## 概要
「いまなにしてる？」は、ユーザーが現在の状況をシェアできるシンプルなタイムラインアプリです。Vercelを使用してデプロイされ、100人程度のユーザーが1ヶ月間使用することを想定しています。

## 機能
- 名前入力によるログイン（クッキーで記憶）
- 50文字以内の投稿機能
- リアルタイムタイムライン表示（3秒おきのポーリング）
- ログアウト機能
- 最新1000件の投稿表示
- 接続状態インジケーター

## ローカル開発環境のセットアップ

### 前提条件
- Node.js 18.0.0以上
- npm または yarn
- Vercel CLI

### インストール手順

1. **Vercel CLIのインストール**
```bash
npm install -g vercel
```

2. **依存関係のインストール**
```bash
cd src
npm install
```

3. **ローカル開発サーバーの起動**
```bash
npm run dev
```

または

```bash
vercel dev
```

4. **ブラウザでアクセス**
```
http://localhost:3000
```

### 開発時の注意事項

- ローカル環境では、投稿データはメモリに保存されるため、サーバーを再起動するとデータが失われます
- 本番環境では、VercelのServerless Functionsが使用され、各関数呼び出し間でデータが保持されます
- 開発中はブラウザの開発者ツールのコンソールでエラーメッセージを確認してください

## デプロイ手順

### Vercelへのデプロイ

1. **Vercelアカウントの作成**
   - [Vercel](https://vercel.com)でアカウントを作成

2. **プロジェクトのインポート**
   - Vercelダッシュボードで「New Project」をクリック
   - GitHubリポジトリを選択
   - プロジェクト設定：
     - Framework Preset: Other
     - Root Directory: `src`
     - Build Command: `npm run build`
     - Output Directory: `src`

3. **環境変数の設定（必要に応じて）**
   - 現在は環境変数は使用していませんが、将来的にデータベース接続などで必要になる場合があります

4. **デプロイの実行**
   - 「Deploy」ボタンをクリック
   - デプロイが完了すると、URLが提供されます

### 自動デプロイの設定

- GitHubリポジトリにプッシュするたびに自動デプロイが実行されます
- `main`ブランチへのプッシュが本番環境にデプロイされます
- プルリクエストはプレビュー環境としてデプロイされます

## ファイル構成

```
src/
├── index.html          # メインのHTMLファイル
├── package.json        # 依存関係とスクリプト
├── vercel.json         # Vercel設定ファイル
└── api/
    └── posts.js        # 投稿API（GET/POST）
```

## API仕様

### GET /api/posts
投稿一覧を取得

**レスポンス:**
```json
{
  "posts": [
    {
      "id": 1234567890,
      "author": "ユーザー名",
      "content": "投稿内容",
      "date": "12月25日",
      "time": "14:30",
      "timestamp": 1234567890000
    }
  ]
}
```

### POST /api/posts
新しい投稿を作成

**リクエストボディ:**
```json
{
  "author": "ユーザー名",
  "content": "投稿内容"
}
```

**レスポンス:**
```json
{
  "success": true,
  "post": {
    "id": 1234567890,
    "author": "ユーザー名",
    "content": "投稿内容",
    "date": "12月25日",
    "time": "14:30",
    "timestamp": 1234567890000
  },
  "totalPosts": 1
}
```

## トラブルシューティング

### よくある問題

1. **ローカルサーバーが起動しない**
   - Node.jsのバージョンを確認（18.0.0以上が必要）
   - `npm install`を実行して依存関係をインストール

2. **APIが404エラーを返す**
   - `vercel.json`の設定を確認
   - APIファイルが`api/`ディレクトリに配置されているか確認

3. **投稿が保存されない**
   - ブラウザの開発者ツールでネットワークタブを確認
   - APIエンドポイントが正しく呼び出されているか確認

4. **ポーリングが動作しない**
   - ブラウザのコンソールでエラーメッセージを確認
   - ネットワーク接続を確認

### ログの確認方法

- **ローカル環境**: ターミナルの出力を確認
- **本番環境**: Vercelダッシュボードの「Functions」タブでログを確認

## パフォーマンス考慮事項

- 投稿は最大1000件まで保持
- 3秒おきのポーリングでリアルタイム性を確保
- ページが非表示の間はポーリングを停止してリソースを節約
- 接続状態インジケーターでユーザーに状態を表示

## 今後の拡張予定

- データベース（PostgreSQL、MongoDB等）の導入
- ユーザー認証の強化
- 画像投稿機能
- プッシュ通知
- 管理者機能

## サポート

問題が発生した場合は、以下を確認してください：
1. このドキュメントのトラブルシューティングセクション
2. Vercelの公式ドキュメント
3. ブラウザの開発者ツールでのエラーメッセージ
